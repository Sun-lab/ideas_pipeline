
R version 4.0.2 (2020-06-22) -- "Taking Off Again"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin17.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # this file combines the pvalue results from step1b, step1c, 
> # and step1d together to a dataframe
> 
> # files to load:
> #   -- the 3 pvalue files
> #   -- the orignal full count matrix to filter out genes with 
> #      too many zeros
> 
> # ========================================================================
> # take arguments
> # ========================================================================
> 
> args = commandArgs(trailingOnly=TRUE)
> args
[1] "grp='PFC_Oligodendrocytes'"
> 
> if (length(args) != 1) {
+   message("one argument is expected, use 'PFC_L2_3' as default.\n")
+   grp = "PFC_L2_3"
+ }else{
+   eval(parse(text=args[[1]]))
+ }
> 
> grp
[1] "PFC_Oligodendrocytes"
> 
> # ========================================================================
> # libraries and path
> # ========================================================================
> 
> library(MASS)
> library(Matrix)
> library(data.table)
> 
> 
> data.dir  = "./data"
> 
> full_dat1 = readRDS(file.path(data.dir, sprintf("ct_mtx/%s.rds", grp)))
> full_genes = rownames(full_dat1)  
> 
> n.zeros = rowSums(full_dat1 == 0)
> summary(n.zeros)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0    9059    9382    9070    9497    9548 
> w2kp = which(n.zeros < 0.8*ncol(full_dat1))
> length(w2kp)
[1] 939
> 
> # DESeq2 pvalues did not filter out genes with large proportion of zeros
> # need to repeat the filtering out genes step to get the genes we want
> pvals_deseq2     = fread(sprintf("res/step1b_DESeq2_%s_adj_covariates.tsv", grp))
> pvals_nb_rd      = fread(sprintf("res/step1c_nb_pvals_%s.tsv", grp))
> pvals_dca_direct = fread(sprintf("res/step1d_dca_direct_pvals_%s.tsv", grp))
> 
> 
> # add row name and gene column to help verify results after filtering
> row.names(pvals_deseq2) = full_genes 
> pvals_deseq2$gene = full_genes
> pvals_deseq2 = pvals_deseq2[w2kp]
> 
> 
> pvals = cbind(pvals_nb_rd$gene, pvals_deseq2$pvalue, pvals_nb_rd[, 2:5], 
+               pvals_dca_direct[, 2:5])
> names(pvals)[1] = "gene"
> names(pvals)[2] = "DESeq2"
> 
> dim(pvals)
[1] 939  10
> head(pvals)
     gene    DESeq2 KR_nb_Was KR_nb_JSD PS_nb_Was PS_nb_JSD KR_dca_direct_Was
1:  KIF1B 0.3823373    0.0989    0.0906    0.0620    0.0532            0.1288
2:  UBE4B 0.7915239    0.7992    0.8180    0.7312    0.6688            0.3046
3:   RERE 0.8279787    0.5794    0.5024    0.3034    0.3214            0.0883
4: CAMTA1 0.2287409    0.3468    0.3782    0.3870    0.4174            0.5588
5:   KAZN 0.5037605    0.5960    0.9612    0.4752    0.9430            0.8476
6: EIF4G3 0.4860811    0.9600    0.9040    0.9544    0.9118            0.5012
   KR_dca_direct_JSD PS_dca_direct_Was PS_dca_direct_JSD
1:            0.1210            0.0802            0.0684
2:            0.2520            0.1312            0.0725
3:            0.0726            0.1060            0.0795
4:            0.6852            0.4336            0.6374
5:            0.5616            0.7684            0.4450
6:            0.3888            0.3894            0.3020
> 
> file.name = sprintf("res/step1e_pvals_%s.tsv", 
+                     grp)
> fwrite(pvals, file = file.name, sep = "\t")
> 
> proc.time()
   user  system elapsed 
  2.913   0.985   4.118 
